#!/bin/sh
################################
#   By:Dapeng  专用防盗LOGO    #
# By:Dapeng 大鹏QQ：787532085  #
#      分享是一种美得！        #
#     防君子   防不住小人      #
#   欢迎使用，大鹏架设一件端   #
#愿意偷 愿意改 就拿走吧 拦不住 #
#最后送个妹子给你们  拿去用吧  #
################################
#                   o888888o o88888888o 
#                 8888888888888888888888888o 
#               888::::888888888888888888888888o 
#             88::::::::88888888888888888888888888o 
#           o8:::::::::888::顶88888888888888888888888 
#          8888:8::::::8:::::::::顶88888888888888888888 
#         8888::::8888::::::::::::::::顶88888888888 ''''88
#        8888:::888888888::::::::::::::::顶888888888 8
#       88 88888888888888888:::::::::::::顶88888888888
#      88  888888888888888888:::::::::::顶88888888888888
#      88 888888888888888888888::::::::顶88888888888888888
#      8  8888888888888888888888::::::顶88888888888888888888
#        8888888888888888::88888:::::顶8888888888888888888888
#      88888888888888888::::8888::::顶8888888888888888 ''''8888
#     88888888888888888::::8888::::顶:8::***::888888888 888
#    88888888888888888::::888:::::顶::::*EYE*::888888888 88
#  888888888888888888::::88::::::顶:::::::::::::888888888 88
# 8888888888888888888::::8::::::顶:::::::::::::顶888888888 88
#888   8888888888::88::::8:::::顶:::8oo8::::::88888888888888 8
#88   88888888888:::8:::::::::顶:::::::::::::88888888888888888
# 8  8888888888888:::::::::::顶::"8888888":::顶88888888888888888
#  8888888888::888::::::::::顶:::::"8a8"::::顶88888888888888888888
# 888888888:::::88:::::::::顶88::::::::::::顶88888888888888888888888
#8888888888:::::8:::::::::顶88888::::::::顶888888888888888888888888888
#888888888:::::8:::::::::顶8888888ooooo顶8888888888888888888888888888888
#888888 顶::::::::::::::顶8888888888::::::顶8888888888888888 ''''888888888
#8888  顶:::::::::::::::顶88888888888::::::顶8888888888888888 88888888
# 888  顶::::::::::::::顶8888888888888:::::::顶888888888888888 888888
#  888 顶:::::::::::::顶88888888888888888::::::顶8888888888888 88888
#   88 顶:::::::::::::8888:88888888888888888:::::顶顶888888888 8888
#   88 顶:::::::::::8888顶::88888::888888888888:::::顶顶88888 888
#   8   顶::::::::::8888顶:::8888:::::88888888888::::::顶顶88 888
#       8顶:::::::8888顶:::::888:::::::88:::8888888:::::::顶顶 88
#      88顶:::::::8888顶::::::88:::::::::8:::::888888::::::::顶顶 88
#     8888顶:::::888顶:::::::::88::::::::::顶::::8888::::::::::::顶 8
#    88888:顶::::888顶::::::::::8:::::::::::顶::::888::::::::::::::顶
#   88 888:顶:::888:顶::::::::::8::::::::::::顶::888::::::::::::::::顶
#   8 88888顶:::88::顶::::::::::::::::::::::::顶:88::::::::::::::::::顶
#     88888顶:::88::顶:::::::::::::::::::::::::顶88:::::::::::::::::::顶
#     88888顶:::88::顶:::::::::::::::::::::::::顶:8::::::::::::::::::::顶
#    888888顶::::8::顶::::::::::::::8888::::::::顶8::::::::::::8888:::::顶
#    88888  顶:::8::顶顶:::::::::::888888:::::::顶::::::::::::888888::::顶
#    8888   顶顶:::::顶顶::::::::::888888:::::::顶顶::::::::::888888::::顶
#    8888    顶:::::::顶顶::::::::::8888:::::::顶顶顶::::::::::8888::::顶''''
#     888    顶顶::::::顶顶顶:::::::::::::::::顶顶::顶::::::::::::::::顶''''
#      88     顶::::::::顶顶顶顶:::::::::::顶顶顶:::顶顶:::::::::::::顶''''
#       88    顶顶:::::::::顶顶顶顶顶顶顶顶顶顶:::::::顶顶顶顶顶顶顶顶''''
#        88    顶顶::::::::::::顶顶顶顶顶顶顶::::::::::::顶顶顶顶顶o''''
#         88   8顶顶::::::::::::::::::::::::::::::::::::::::顶
#          8   88顶顶::::::::::::::::::::::顶:::顶::::::::::顶
#              888顶顶::::::::::::::::::顶顶::::::顶顶::::::顶
#             88888顶顶:::::::::::::::顶顶顶:::::::顶顶:::::顶
#             888888顶顶:::::::::::::顶顶顶:::::::::顶顶:::顶
#            88888888顶顶:::::::::::顶顶顶:::::::::::顶:::顶
#           88 8888888 顶::::::::顶顶顶::::::::::::::顶::顶
#           8  888888  顶::::::顶顶:::::::::::::::::顶::顶
#              888888  顶:::::顶:::::::::::::::::::顶::顶顶
#             888888   顶::::顶::::::::::::::::::::::::顶顶
#             888888   顶::::顶::::::::::::::::::::::::顶:顶
#             88888   顶::::::::::::::8::::::::::::::::顶::顶
#            88888   顶:::::::::::::::88::::::::::::::::顶::顶
#           88888   顶::::::::::::::::8::::::::::::::::::顶::顶
#          88888   顶:::::顶:::::::::::::::::::::顶::::::::顶::顶
#          8888   顶:::::顶:::::::::::::::::::::::顶顶::::::顶::顶
#         8888   顶:::::顶:::::::::::::::::::::::顶顶顶:::::::顶:顶
#        888    顶:::::顶顶::::::::::::::::::::::顶顶顶::::::::顶:顶
#      8888    顶::::::顶顶:::::::::::::::::::::顶顶顶::::::::: 顶:顶
#     888      顶:::::顶:::::::::::::::::::::::顶顶::::::::::::::顶:顶
#  8888       顶::::::::::::::::::::::::::::::顶::::::::::::::::::顶:顶
#             顶::::::::::::::::::::::::::::::::::::::::::::::::::顶:顶
#            顶::::::::顶:::::::::::::::::::::::::::::::::::::::::顶:顶
#            顶::::::::顶:::::::::::::::::顶::::::::::::::::::::::顶:顶
#           顶::::::::::顶::::::::::::::顶::::::::::::::::::::::::顶:顶
#           顶:::::::::::顶8::::::::8:顶:::::::::::::::::::::::::顶:顶p
#           顶::::::::::::888hole888顶:::::::::::::::::::::::::::顶:顶o
#           顶:::::::::::::88888888顶:::::::::::::::::::::::::::顶:顶p
#           顶::::::::::::::888888顶::::::::::::::::::::::::::::顶:顶
#           顶:::::::::::::::88888顶:::::::::::::::::::::::::::顶:顶
#           顶:::::::::::::::::88顶::::::::::::::::::::::::::::顶顶
#           顶:::::::::::::::::::顶:::::::::::::::::::::::::::顶顶
#           顶:::::::::::::::::::顶::::::::::::::::::::::::::顶顶
#            顶:::::::::::::::::顶::::::::::::::::::::::::::顶顶
#            顶:::::::::::::::::顶::::::::::::::::::::::::::顶
#             顶:::::::::::::::顶::::::::::::::::::::::::::顶
#             顶:::::::::::::::顶:::::::::::::::::::::::::顶
#              顶:::::::::::::顶:::::::::::::::::::::::::顶
#              顶:::::::::::::顶:::::::::::::::::::::::顶
#               顶:::::::::::顶:::::::::::::::::::::::顶
#               顶:::::::::::顶::::::::::::::::::::::顶
#                顶:::::::::顶::::::::::::::::::::::顶
#                顶:::::::::顶:::::::::::::::::::::顶
#                 顶:::::::顶:::::::::::::::::::::顶
#                  顶::::::顶::::::::::::::::::::顶
#                  顶:::::顶::::::::::::::::::::顶
#                   顶:::顶::::::::::::::::::::顶
#                   顶::顶::::::::::::::::::::顶
#                    顶:顶:::::::::::::::::::顶
#                    顶顶:::::::::::::::::::顶
#                    顶顶::::::::::::::::::顶
#                    顶顶:::::::::::::::::顶
#                    顶顶:::::顶::::::::顶顶
#                    顶顶::::顶顶:::::::顶顶
#                    顶顶::::::顶顶:::::顶顶
#                     顶顶::::::::::::::顶顶
#                     顶顶::::顶:::::::::顶顶
#                      顶顶::顶顶顶:::::::顶顶
#                      顶顶::顶顶顶:::::::顶顶
#                      顶顶:::顶顶::::::::::顶
#                       顶顶::顶顶::::::::::顶
#                       顶顶::顶顶:::::::::::顶
#                       顶顶:::顶::::::::::::顶
#                       顶顶:::::::::::::::::顶
#                       顶顶:::::::::::::::::顶
#                       顶顶::::::::::::::::::顶
#                       顶顶::::::::::::::::::顶
#                       顶顶::::::::::::::::::顶
#                        顶顶:::::::::::::::::顶
#                        顶顶:::::::::::::::::顶
#                        顶顶:::::::::::::::::顶
#                        顶顶:::::::::::::::::顶
#                        顶顶:::::::::::::::::顶
#                         顶顶:::::::::::::::顶
#                         顶顶:::::::::::::::顶
#                         顶顶:::::::::::::::顶
#                         顶顶::::::::::::::顶
#                          顶顶:::::::::::::顶
#                          顶顶:::::::::::::顶
#                          顶顶:::::::::::::顶
#                          顶顶::::::::::::顶
#                          顶顶::::::::::::顶
#                           顶顶:::::::::::顶
#                           顶顶::::::::::顶
#                           顶顶::::::::::顶
#                            顶顶::::::::顶
#                            顶顶::::::::顶
#                            顶顶::::::::顶
#                             顶顶:::::::顶
#                             顶顶:::::::顶
#                              顶顶::::::顶
#                              顶顶::::::顶
#                              顶顶::::::顶
#                             顶顶::::::顶
#                              顶顶::::::顶
#                              顶顶::::::顶
#                             顶顶:::::::顶
#                            顶:顶::::::::顶
#                            顶:顶:::::::::顶
#                            顶:顶::::::::::顶
#                            顶:顶:::::::::::顶
#                            顶:顶::::::::::::顶
#                            顶:顶:::::::::::::顶
#                            顶:顶::::::::::::::顶
#                            顶顶:::::::::::::::::顶
#                              顶顶::::::::::::::::顶
#                                顶顶顶:::::::::顶顶
#                                  顶顶::顶::::顶顶
#                                   顶顶顶顶顶顶顶
#                                      顶顶顶顶顶#
function install() {
	centos=`cat /etc/redhat-release`
    XT=`cat /etc/redhat-release | awk '{print $3}'| cut -b1`
	CPU=$(grep 'model name' /proc/cpuinfo |uniq |awk -F : '{print $2}' |sed 's/^[ \t]*//g' |sed 's/ \+/ /g') 
	H=`cat /proc/cpuinfo | grep "physical id" | sort | uniq | wc -l`
	HX=`cat /proc/cpuinfo | grep "core id" |wc -l`
	DD=`df -h /`
    W=`getconf LONG_BIT`
	G=`awk '/MemTotal/{printf("%1.1fG\n",$2/1024/1024)}' /proc/meminfo`
	IP=`curl ip.cip.cc`
	if [ -z $IP ]; then
	IP=`curl ip.cip.cc`
	fi

echo -e "\033[1;33m===================================服务器配置===================================\033[0m"
echo -e "\033[1;32m                 系统版本：$centos   $W 位 \033[0m"
echo -e "\033[1;32m                 CPU 型号：${CPU} \033[0m"
echo -e "\033[1;32m                 CPU核心：$HX核  \033[0m"
echo -e "\033[1;32m                 运行内存：$G     \033[0m"
echo -e "\033[1;33m==================================硬盘使用情况==================================\033[0m"
echo -e "\033[1;32m$DD\033[0m"
echo -e "\033[1;33m================================================================================\033[0m"
echo -e "\033[32m  \033[0m"
echo -e "\033[1;31m################################################################################\033[0m"
echo -e "\033[1;31m###                                                                          ###\033[0m"
echo -e "\033[1;31m###                         大鹏资源站一键架设端                             ###\033[0m"
echo -e "\033[1;31m###                            交流群:589492843                              ###\033[0m"
echo -e "\033[1;31m###                         交流论坛：bbs.97dp.com                           ###\033[0m"
echo -e "\033[1;31m###                  一句指令云端架设脚本，无后门，永久免费                  ###\033[0m"
echo -e "\033[1;31m###             自动检测 5 - 7 系 并进入对应的架设，按回车键继续             ###\033[0m"
echo -e "\033[1;31m###                                                                          ###\033[0m"
echo -e "\033[1;31m################################################################################\033[0m" 
	read
	service0
	service5
}
cd 
reset
rm -rf /ssh
rm -rf /root/ssh
function service0() {
echo -e "\033[1;33m================================================================================\033[0m"
echo -e "\033[1;36m                 1.安装独立端[推荐](数据库目录:/var/lib/mysql)\033[0m"
echo -e "\033[1;36m                 2.安装集成端(数据库目录:/opt/lampp/var/mysql)\033[0m"
echo -e "\033[1;36m                 3.安装PHP环境(httpd 集成端自带!请勿安装!)\033[0m"
echo -e "\033[1;36m                 4.数据库备份与还原(请注意同端转移)\033[0m"
echo -e "\033[1;36m                 5.清除服务端缓存垃圾(log,pid,MMAP,core)\033[0m"
echo -e "\033[1;36m                 6.任意键退出安装\033[0m"
echo -e "\033[1;33m================================================================================\033[0m"  
	read -p "输入选项: " number
	NUMBER=$number
	if [ "$NUMBER" = "1" ] ; then
		service1
	elif [ "$NUMBER" = "2" ] ; then
		service2
	elif [ "$NUMBER" = "3" ] ; then
	    echo -n "请注意！PHP目录：var/www/html/ 默认端口号735！请按回车键继续！" 
	    read
	    yum install php-gd* php php-mysql openssl httpd php-mysql -y
		sed -i "/Listen 80/a\Listen 735" /etc/httpd/conf/httpd.conf
	    chkconfig httpd on
	    service httpd restart
	elif [ "$NUMBER" = "4" ] ; then
		service4
	elif [ "$NUMBER" = "5" ] ; then
		find /home/ -name '*.log' -type f -print -exec rm -f {} \;
		find /home/ -name '*.pid' -type f -print -exec rm -f {} \;
		find /home/ -name '*.MMAP' -type f -print -exec rm -f {} \;
		find /home/ -name 'core.*' -type f -print -exec rm -f {} \;
	elif [ "$NUMBER" = "6" ] ; then
		service5
	elif [ "$NUMBER" = "7" ] ; then
		service5
	elif [ "$NUMBER" = "8" ] ; then
		service5
	elif [ "$NUMBER" = "j" ] ; then
		servicej
    else
        exit 0
    fi
}
function service1() {
    if [ "$XT" = "5" ] ; then
		rm  -rf /etc/yum.repos.d/*
		curl -o /etc/yum.repos.d/CentOS-Base.repo http://GongJu.97dp.com/Duan/repo/CentOS5-Base.repo
		yum clean all
		yum makecache
		yes y | head -1 | yum remove mysql mysql-* -y;
		yum install -y mysql
		yum install -y mysql-server 
		yum install -y mysql-devel
		chkconfig mysqld on
		curl -o /MySQL.tar.gz http://GongJu.97dp.com/Duan/Server/DapengMySQL.tar.gz
    	rm -rf /var/lib/mysql/*
		cd /;tar -zxvf MySQL.tar.gz
		chmod -R 0777 /var/lib/mysql
		chown -R mysql.mysql /var/lib/mysql/
		service mysqld restart
	elif [ "$XT" = "6" ] ; then
		rm  -rf /etc/yum.repos.d/*
		curl -o /etc/yum.repos.d/CentOS-Base.repo http://GongJu.97dp.com/Duan/repo/CentOS6-Base.repo
		yum clean all
		yum makecache
		yes y | head -1 | yum remove mysql mysql-* -y;
		yum install -y mysql
		yum install -y mysql-server 
		yum install -y mysql-devel
		chkconfig mysqld on
		curl -o /MySQL.tar.gz http://GongJu.97dp.com/Duan/Server/DapengMySQL.tar.gz
    	rm -rf /var/lib/mysql/*
		cd /;tar -zxvf MySQL.tar.gz
		chmod -R 0777 /var/lib/mysql
		chown -R mysql.mysql /var/lib/mysql/
		service mysqld restart
	elif [ "$XT" = "r" ] ; then
		rm  -rf /etc/yum.repos.d/*
		curl -o /etc/yum.repos.d/CentOS-Base.repo http://GongJu.97dp.com/Duan/repo/CentOS7-Base.repo
		yum clean all
		yum makecache
		curl -o /MySQL.tar.gz http://GongJu.97dp.com/Duan/Server/DapengMySQL.tar.gz
    	rm -rf /var/lib/mysql/*
		yes y | head -1 | yum remove mysql mysql-* -y;
		yum -y remove maria*
		yum install mariadb-server -y
		systemctl enable mariadb
		cd /;tar -zxvf MySQL.tar.gz
		chmod -R 0777 /var/lib/mysql
		systemctl restart mariadb
    else
        exit 0
    fi
	service3
}
function service2() {
    if [ "$XT" = "5" ] ; then
		curl -o /XAMPP.tar.gz http://GongJu.97dp.com/Duan/Server/DapengXAMPP.tar.gz
		cd /;tar -zxvf XAMPP.tar.gz
		yum install -y glibc*i686
		cd /opt/lampp;./lampp start
	elif [ "$XT" = "6" ] ; then
		rm  -rf /etc/yum.repos.d/*
		curl -o /etc/yum.repos.d/CentOS-Base.repo http://GongJu.97dp.com/Duan/repo/CentOS6-Base.repo
		yum clean all
		yum makecache
		curl -o /XAMPP.tar.gz http://GongJu.97dp.com/Duan/Server/DapengXAMPP.tar.gz
		cd /;tar -zxvf XAMPP.tar.gz
		yum install -y glibc*i686
		cd /opt/lampp;./lampp start
	elif [ "$XT" = "r" ] ; then
		rm  -rf /etc/yum.repos.d/*
		curl -o /etc/yum.repos.d/CentOS-Base.repo http://GongJu.97dp.com/Duan/repo/CentOS7-Base.repo
		yum clean all
		yum makecache
		curl -o /XAMPP.tar.gz http://GongJu.97dp.com/Duan/Server/DapengXAMPP.tar.gz
		cd /;tar -zxvf XAMPP.tar.gz
		yum install -y glibc*i686
		cd /opt/lampp;./lampp start
    else
        exit 0
    fi
	service98
}
function service98(){
        echo "下载集成端数据库"
		curl -o /JCDMYSQL.tar.gz http://GongJu.97dp.com/Duan/Server/DapengJCDMYSQL.tar.gz
		echo "安装集成端数据库并且重启数据库"
		cd /;rm -rf /opt/lampp/var/mysql;tar -zxvf JCDMYSQL.tar.gz -C /;/opt/lampp/lampp restart
		echo "运行完成"
		service99
}
function service3() {
    if [ "$XT" = "5" ] ; then
		echo " "
		echo "正在进行安装"
		echo " "
		echo "检测到系统是5系"
		echo " "
		echo "正在下载一键端文件"
		echo " "
		curl -o /DNFServer.tar.gz http://GongJu.97dp.com/Duan/Server/DapengYJDServer.tar.gz
		echo " "
		echo "正在解压一键端文件"
		cd /;tar -zxvf DNFServer.tar.gz
		cd /home/bbs.97dp.com
		sed -i "s/Public IP/${IP}/g" `find . -type f -name "*.cfg"`
		sed -i "s/SELINUX=enforcing/SELINUX=disabled/g" /etc/sysconfig/selinux
		setenforce 0
		echo " "
		echo "解压一键端文件完成"
		echo " "
		echo "开始创建虚拟内存"
		echo "这里请耐心等待，最快1-10分钟，最慢30分钟左右。"
		dd if=/dev/zero of=/home/bbs.97dp.com/dnfnc bs=1M count=8192
		mkswap /home/bbs.97dp.com/dnfnc
		swapon /home/bbs.97dp.com/dnfnc
		sed -i '$a /home/bbs.97dp.com/dnfnc swap swap defaults 0 0' /etc/fstab
		echo "创建虚拟内存完成"
		rm -f /var/run/yum.pid
		echo "开始关闭防火墙"
		service iptables stop
		chkconfig iptables off
		echo "防火墙关闭完成"
		cd
		echo 1 > /proc/sys/vm/drop_caches
	elif [ "$XT" = "6" ] ; then
		echo " "
		echo "正在进行安装"
		echo " "
		echo "检测到系统是6系"
		echo " "
		echo "正在下载一键端文件"
		echo " "
		curl -o /DNFServer.tar.gz http://GongJu.97dp.com/Duan/Server/DapengYJDServer.tar.gz
		echo " "
		echo "正在解压一键端文件"
		cd /;tar -zxvf DNFServer.tar.gz
		cd /home/bbs.97dp.com
		sed -i "s/Public IP/${IP}/g" `find . -type f -name "*.cfg"`
		sed -i "s/SELINUX=enforcing/SELINUX=disabled/g" /etc/sysconfig/selinux
		setenforce 0
		echo " "
		echo "解压一键端文件完成"
		echo " "
		echo "开始创建虚拟内存"
		echo "这里请耐心等待，最快1-10分钟，最慢30分钟左右。"
		dd if=/dev/zero of=/home/bbs.97dp.com/dnfnc bs=1M count=8192
		mkswap /home/bbs.97dp.com/dnfnc
		swapon /home/bbs.97dp.com/dnfnc
		sed -i '$a /home/bbs.97dp.com/dnfnc swap swap defaults 0 0' /etc/fstab
		echo "创建虚拟内存完成"
		echo " "
		rm -f /var/run/yum.pid
		yum -y install glibc.i686
		yum -y install xulrunner.i686
		yum -y install libXtst
		yum -y install gcc gcc-c++ make zlib-devel
		echo "支持库安装完毕"
		echo " "
		echo "开始关闭防火墙"
		service iptables stop
		chkconfig iptables off
		echo "防火墙关闭完成"
		cd
		echo 1 > /proc/sys/vm/drop_caches
	elif [ "$XT" = "r" ] ; then
		echo " "
		echo "正在进行安装"
		echo " "
		echo "检测到系统是7系"
		echo " "
		echo "正在下载一键端文件"
		echo " "
		curl -o /DNFServer.tar.gz http://GongJu.97dp.com/Duan/Server/DapengYJDServer.tar.gz
		echo " "
		echo "正在解压一键端文件"
		cd /;tar -zxvf DNFServer.tar.gz
		cd /home/bbs.97dp.com
		sed -i "s/Public IP/${IP}/g" `find . -type f -name "*.cfg"`
		sed -i "s/SELINUX=enforcing/SELINUX=disabled/g" /etc/sysconfig/selinux
		setenforce 0
		echo " "
		echo "解压一键端文件完成"
		echo " "
		echo "开始创建虚拟内存"
		echo "这里请耐心等待，最快1-10分钟，最慢30分钟左右。"
		dd if=/dev/zero of=/home/bbs.97dp.com/dnfnc bs=1M count=8192
		mkswap /home/bbs.97dp.com/dnfnc
		swapon /home/bbs.97dp.com/dnfnc
		sed -i '$a /home/bbs.97dp.com/dnfnc swap swap defaults 0 0' /etc/fstab
		echo "创建虚拟内存完成"
		echo " "
		echo "正在安装支持库"
		rm -f /var/run/yum.pid
		yum -y install glibc.i686
		yum -y install xulrunner.i686
		yum -y install libXtst
		yum -y install gcc gcc-c++ make zlib-devel
		echo "支持库安装完毕"
		echo " "
		echo "开始关闭防火墙"
		systemctl disable firewalld
		systemctl stop firewalld
		systemctl disable firewalld.service
		systemctl stop firewalld.service
		echo "防火墙关闭完成"
		cd
		echo 1 > /proc/sys/vm/drop_caches
    else
        exit 0
    fi
	echo -n "安装已完成,是否继续安装PHP环境？注意！集成端请勿安装！  y/n [n] ?"
    read ANS
    case $ANS in
    y|Y|yes|Yes)
	yum install php-gd* php php-mysql openssl httpd php-mysql -y
	sed -i "/Listen 80/a\Listen 735" /etc/httpd/conf/httpd.conf
	chkconfig httpd on
	service httpd restart
    ;;
    n|N|no|No)
    ;;
    *)
    ;;
    esac 
}
function service99() {
    if [ "$XT" = "5" ] ; then
		echo " "
		echo "正在进行安装"
		echo " "
		echo "检测到系统是5系"
		echo " "
		echo "正在下载一键端文件"
		echo " "
		curl -o /DNFServer.tar.gz http://GongJu.97dp.com/Duan/Server/DapengYJDServer.tar.gz
		echo " "
		echo "正在解压一键端文件"
		cd /;tar -zxvf DNFServer.tar.gz
		cd /home/bbs.97dp.com
		sed -i "s/Public IP/${IP}/g" `find . -type f -name "*.cfg"`
		sed -i "s/SELINUX=enforcing/SELINUX=disabled/g" /etc/sysconfig/selinux
		setenforce 0
		echo " "
		echo "解压一键端文件完成"
		echo " "
		echo "开始创建虚拟内存"
		echo "这里请耐心等待，最快1-10分钟，最慢30分钟左右。"
		dd if=/dev/zero of=/home/bbs.97dp.com/dnfnc bs=1M count=8192
		mkswap /home/bbs.97dp.com/dnfnc
		swapon /home/bbs.97dp.com/dnfnc
		sed -i '$a /home/bbs.97dp.com/dnfnc swap swap defaults 0 0' /etc/fstab
		echo "创建虚拟内存完成"
		rm -f /var/run/yum.pid
		echo "开始关闭防火墙"
		service iptables stop
		chkconfig iptables off
		echo "防火墙关闭完成"
		cd
		echo 1 > /proc/sys/vm/drop_caches
	elif [ "$XT" = "6" ] ; then
		echo " "
		echo "正在进行安装"
		echo " "
		echo "检测到系统是6系"
		echo " "
		echo "正在下载一键端文件"
		echo " "
		curl -o /DNFServer.tar.gz http://GongJu.97dp.com/Duan/Server/DapengYJDServer.tar.gz
		echo " "
		echo "正在解压一键端文件"
		cd /;tar -zxvf DNFServer.tar.gz
		cd /home/bbs.97dp.com
		sed -i "s/Public IP/${IP}/g" `find . -type f -name "*.cfg"`
		sed -i "s/SELINUX=enforcing/SELINUX=disabled/g" /etc/sysconfig/selinux
		setenforce 0
		echo " "
		echo "解压一键端文件完成"
		echo " "
		echo "开始创建虚拟内存"
		echo "这里请耐心等待，最快1-10分钟，最慢30分钟左右。"
		dd if=/dev/zero of=/home/bbs.97dp.com/dnfnc bs=1M count=8192
		mkswap /home/bbs.97dp.com/dnfnc
		swapon /home/bbs.97dp.com/dnfnc
		sed -i '$a /home/bbs.97dp.com/dnfnc swap swap defaults 0 0' /etc/fstab
		echo "创建虚拟内存完成"
		echo " "
		rm -f /var/run/yum.pid
		yum -y install glibc.i686
		yum -y install xulrunner.i686
		yum -y install libXtst
		yum -y install gcc gcc-c++ make zlib-devel
		echo "支持库安装完毕"
		echo " "
		echo "开始关闭防火墙"
		service iptables stop
		chkconfig iptables off
		echo "防火墙关闭完成"
		cd
		echo 1 > /proc/sys/vm/drop_caches
	elif [ "$XT" = "r" ] ; then
		echo " "
		echo "正在进行安装"
		echo " "
		echo "检测到系统是7系"
		echo " "
		echo "正在下载一键端文件"
		echo " "
		curl -o /DNFServer.tar.gz http://GongJu.97dp.com/Duan/Server/DapengYJDServer.tar.gz
		echo " "
		echo "正在解压一键端文件"
		cd /;tar -zxvf DNFServer.tar.gz
		cd /home/bbs.97dp.com
		sed -i "s/Public IP/${IP}/g" `find . -type f -name "*.cfg"`
		sed -i "s/SELINUX=enforcing/SELINUX=disabled/g" /etc/sysconfig/selinux
		setenforce 0
		echo " "
		echo "解压一键端文件完成"
		echo " "
		echo "开始创建虚拟内存"
		echo "这里请耐心等待，最快1-10分钟，最慢30分钟左右。"
		dd if=/dev/zero of=/home/bbs.97dp.com/dnfnc bs=1M count=8192
		mkswap /home/bbs.97dp.com/dnfnc
		swapon /home/bbs.97dp.com/dnfnc
		sed -i '$a /home/bbs.97dp.com/dnfnc swap swap defaults 0 0' /etc/fstab
		echo "创建虚拟内存完成"
		echo " "
		echo "正在安装支持库"
		rm -f /var/run/yum.pid
		yum -y install glibc.i686
		yum -y install xulrunner.i686
		yum -y install libXtst
		yum -y install gcc gcc-c++ make zlib-devel
		echo "支持库安装完毕"
		echo " "
		echo "开始关闭防火墙"
		systemctl disable firewalld
		systemctl stop firewalld
		systemctl disable firewalld.service
		systemctl stop firewalld.service
		echo "防火墙关闭完成"
		cd
		echo 1 > /proc/sys/vm/drop_caches
    else
        exit 0
    fi
}
function servicej() {
    if [ "$XT" = "5" ] ; then
		echo " "
		echo "正在进行安装"
		echo " "
		echo "检测到系统是5系"
		echo " "
		read -p "请输入你的数据库IP: " mysql
		MYSQL=$mysql
		read -p "请输入明文密码: " passwd
		PASSWD=$passwd
		read -p "请输入密文密码: " pwdkey
		PWDKey=$pwdkey
		echo " "
		echo "正在下载一键端文件"
		echo " "
		curl -o /DNFServer.tar.gz http://GongJu.97dp.com/Duan/Server/DapengYJQServer.tar.gz
		echo " "
		echo "正在解压一键端文件"
		cd /;tar -zxvf DNFServer.tar.gz
		cd /home/bbs.97dp.com
		sed -i "s/Public IP/${IP}/g" `find . -type f -name "*.cfg"`
		sed -i "s/MySQL IP/${MYSQL}/g" `find . -type f -name "*.cfg"`
		sed -i "s/MySQL PWD/${PASSWD}/g" `find . -type f -name "*.cfg"`
		sed -i "s/MySQL Key/${PWDKey}/g" `find . -type f -name "*.cfg"`
		sed -i "s/SELINUX=enforcing/SELINUX=disabled/g" /etc/sysconfig/selinux
		setenforce 0
		echo " "
		echo "解压一键端文件完成"
		echo " "
		echo "开始创建虚拟内存"
		echo "这里请耐心等待，最快1-10分钟，最慢30分钟左右。"
		dd if=/dev/zero of=/home/bbs.97dp.com/dnfnc bs=1M count=8192
		mkswap /home/bbs.97dp.com/dnfnc
		swapon /home/bbs.97dp.com/dnfnc
		sed -i '$a /home/bbs.97dp.com/dnfnc swap swap defaults 0 0' /etc/fstab
		echo "创建虚拟内存完成"
		rm -f /var/run/yum.pid
		echo "开始关闭防火墙"
		service iptables stop
		chkconfig iptables off
		cd
		echo 1 > /proc/sys/vm/drop_caches
	elif [ "$XT" = "6" ] ; then
		echo " "
		echo "正在进行安装"
		echo " "
		echo "检测到系统是6系"
		echo " "
		read -p "请输入你的数据库IP: " mysql
		MYSQL=$mysql
		read -p "请输入明文密码: " passwd
		PASSWD=$passwd
		read -p "请输入密文密码: " pwdkey
		PWDKey=$pwdkey
		echo " "
		echo "正在下载一键端文件"
		echo " "
		curl -o /DNFServer.tar.gz http://GongJu.97dp.com/Duan/Server/DapengYJQServer.tar.gz
		echo " "
		echo "正在解压一键端文件"
		cd /;tar -zxvf DNFServer.tar.gz
		cd /home/bbs.97dp.com
		sed -i "s/Public IP/${IP}/g" `find . -type f -name "*.cfg"`
		sed -i "s/MySQL IP/${MYSQL}/g" `find . -type f -name "*.cfg"`
		sed -i "s/MySQL PWD/${PASSWD}/g" `find . -type f -name "*.cfg"`
		sed -i "s/MySQL Key/${PWDKey}/g" `find . -type f -name "*.cfg"`
		sed -i "s/SELINUX=enforcing/SELINUX=disabled/g" /etc/sysconfig/selinux
		setenforce 0
		echo " "
		echo "解压一键端文件完成"
		echo " "
		echo "开始创建虚拟内存"
		echo "这里请耐心等待，最快1-10分钟，最慢30分钟左右。"
		dd if=/dev/zero of=/home/bbs.97dp.com/dnfnc bs=1M count=8192
		mkswap /home/bbs.97dp.com/dnfnc
		swapon /home/bbs.97dp.com/dnfnc
		sed -i '$a /home/bbs.97dp.com/dnfnc swap swap defaults 0 0' /etc/fstab
		echo "创建虚拟内存完成"
		rm -f /var/run/yum.pid
		yum -y install glibc.i686
		yum -y install xulrunner.i686
		yum -y install libXtst
		yum -y install gcc gcc-c++ make zlib-devel
		echo "支持库安装完毕"
		echo "开始关闭防火墙"
		service iptables stop
		chkconfig iptables off
		echo "防火墙关闭完成"
		cd
		echo 1 > /proc/sys/vm/drop_caches
	elif [ "$XT" = "r" ] ; then
		echo " "
		echo "正在进行安装"
		echo " "
		echo "检测到系统是7系"
		echo " "
		read -p "请输入你的数据库IP: " mysql
		MYSQL=$mysql
		read -p "请输入明文密码: " passwd
		PASSWD=$passwd
		read -p "请输入密文密码: " pwdkey
		PWDKey=$pwdkey
		echo " "
		echo "正在下载一键端文件"
		echo " "
		curl -o /DNFServer.tar.gz http://GongJu.97dp.com/Duan/Server/DapengYJQServer.tar.gz
		echo " "
		echo "正在解压一键端文件"
		cd /;tar -zxvf DNFServer.tar.gz
		cd /home/bbs.97dp.com
		sed -i "s/Public IP/${IP}/g" `find . -type f -name "*.cfg"`
		sed -i "s/MySQL IP/${MYSQL}/g" `find . -type f -name "*.cfg"`
		sed -i "s/MySQL PWD/${PASSWD}/g" `find . -type f -name "*.cfg"`
		sed -i "s/MySQL Key/${PWDKey}/g" `find . -type f -name "*.cfg"`
		sed -i "s/SELINUX=enforcing/SELINUX=disabled/g" /etc/sysconfig/selinux
		setenforce 0
		echo " "
		echo "解压一键端文件完成"
		echo " "
		echo "开始创建虚拟内存"
		echo "这里请耐心等待，最快1-10分钟，最慢30分钟左右。"
		dd if=/dev/zero of=/home/bbs.97dp.com/dnfnc bs=1M count=8192
		mkswap /home/bbs.97dp.com/dnfnc
		swapon /home/bbs.97dp.com/dnfnc
		sed -i '$a /home/bbs.97dp.com/dnfnc swap swap defaults 0 0' /etc/fstab
		echo "创建虚拟内存完成"
		echo "正在安装支持库"
		rm -f /var/run/yum.pid
		yum -y install glibc.i686
		yum -y install xulrunner.i686
		yum -y install libXtst
		yum -y install gcc gcc-c++ make zlib-devel
		echo "支持库安装完毕"
		echo "开始关闭防火墙"
		systemctl disable firewalld
		systemctl stop firewalld
		systemctl disable firewalld.service
		systemctl stop firewalld.service
		echo "防火墙关闭完成"
		cd
		echo 1 > /proc/sys/vm/drop_caches
    else
        exit 0
    fi
	service5
}
function service4() {
echo -e "\033[33m=========================================================================\033[0m"
echo -e "\033[36m                 1.备份独立端数据库(数据库目录:/var/lib/mysql)\033[0m"
echo -e "\033[36m                 2.还原独立端数据库(数据库目录:/var/lib/mysql)\033[0m"
echo -e "\033[36m                 3.备份集成端数据库(数据库目录:/opt/lampp/var/mysql)\033[0m"
echo -e "\033[36m                 4.还原集成端数据库(数据库目录:/opt/lampp/var/mysql)\033[0m"
echo -e "\033[36m                 5.退出备份\033[0m"
echo -e "\033[33m==========================================================================\033[0m"  
	read -p "输入选项: " numbera
	NUMBERA=$numbera
	if [ "$NUMBERA" = "1" ] ; then
	    echo -n "请注意！文件MySQL.tar.gz备份在root目录！请按回车键继续！" 
	    read
	    service mysqld stop
		systemctl stop mariadb
		tar -zcvf /root/MySQL.tar.gz /var/lib/mysql
		service mysqld restart
		systemctl restart mariadb
	elif [ "$NUMBERA" = "2" ] ; then
	    echo -n "请注意！请把MySQL.tar.gz上传到根目录！请按回车键继续！" 
	    read
	    service mysqld stop
		systemctl stop mariadb
	    rm -rf /var/lib/mysql/*
	    cd /;tar -zxvf MySQL.tar.gz -C /
	    service mysqld restart
		systemctl restart mariadb
	    rm -rf /*.tar.gz
	elif [ "$NUMBERA" = "3" ] ; then
	    echo -n "请注意！文件MySQL.tar.gz备份在root目录！请按回车键继续！" 
	    read
	    tar -zcvf /root/MySQL.tar.gz /opt/lampp/var/mysql
	elif [ "$NUMBERA" = "4" ] ; then
	    echo -n "请注意！请把MySQL.tar.gz上传到根目录！请按回车键继续！" 
	    read
		rm -rf /opt/lampp/var/mysql
		cd /;tar -zxvf MySQL.tar.gz -C /
		reboot
	elif [ "$NUMBERA" = "5" ] ; then
        service5
    else
        exit 0
    fi
}
function service5() {
	rm -rf /*.tar.gz
}
install
echo -e "\033[1;31m################################################################################\033[0m" 
echo -e "\033[1;31m###                                                                          ###\033[0m"
echo -e "\033[1;31m###                              恭喜您,架设完成                             ###\033[0m"
echo -e "\033[1;31m###                数据库默认帐号为：game    密码为：bbs.97dp.com            ###\033[0m"
echo -e "\033[1;31m###  请自行上传Script.pvf、publickey.pem、df_game_r到home/neople/game目录下  ###\033[0m"
echo -e "\033[1;31m###                   集成端PHP配置目录：/opt/lampp/htdocs                   ###\033[0m"
echo -e "\033[1;31m###                 端口修改位置：/opt/lampp/etc/httpd.conf                  ###\033[0m"
echo -e "\033[1;31m###                启动服务端命令为“./run”，关闭命令为“./stop                ###\033[0m"
echo -e "\033[1;31m###                            QQ交流群：589492843                           ###\033[0m"
echo -e "\033[1;31m###                              作者：787532085                             ###\033[0m"
echo -e "\033[1;31m###                                                                          ###\033[0m"
echo -e "\033[1;31m################################################################################\033[0m" 

cd
